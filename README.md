# 005 –ë–æ—Ç - Telegram-–±–æ—Ç

[![License: Apache 2.0](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)

–°–µ—Ä–≤–∏—Å –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤ Telegram –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—Ç–∫–ª—é—á–µ–Ω–∏—è—Ö, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–∏ÃÜ. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—é —É–ª–∏—Ü—ã.

–ü—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å—Ç–∞–¥–∏–∏ MVP –∏ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [005 –ë–æ—Ç - Telegram-–±–æ—Ç](#005-–±–æ—Ç---telegram-–±–æ—Ç)
  - [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)
  - [–û –ø—Ä–æ–µ–∫—Ç–µ](#–æ-–ø—Ä–æ–µ–∫—Ç–µ)
  - [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)
  - [–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã](#–Ω–∞—á–∞–ª–æ-—Ä–∞–±–æ—Ç—ã)
    - [–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
    - [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
  - [–ù–∞—Å—Ç—Ä–æ–π–∫–∞](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
  - [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
    - [–ó–∞–ø—É—Å–∫](#–∑–∞–ø—É—Å–∫)
    - [–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞](#–∫–æ–º–∞–Ω–¥—ã-–±–æ—Ç–∞)
    - [–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã](#–ø—Ä–∏–º–µ—Ä-—Ä–∞–±–æ—Ç—ã)
  - [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
  - [–î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞](#–¥–æ—Ä–æ–∂–Ω–∞—è-–∫–∞—Ä—Ç–∞)
  - [–õ–∏—Ü–µ–Ω–∑–∏—è](#–ª–∏—Ü–µ–Ω–∑–∏—è)


## –û –ø—Ä–æ–µ–∫—Ç–µ

Telegram-–±–æ—Ç –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–± –æ—Ç–∫–ª—é—á–µ–Ω–∏—è—Ö –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã—Ö —É—Å–ª—É–≥ –≤ –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–µ. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ Redis pub/sub
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É–ª–∏—Ü–∞–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä—Å–µ—Ä–∞ –∞–¥—Ä–µ—Å–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã: polling –∏ webhook
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å emoji –∏ Markdown
- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫

–ò—Å—Ç–æ—á–Ω–∏–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ç–∫–ª—é—á–µ–Ω–∏—è—Ö: [https://005–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫.—Ä—Ñ](https://005–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫.—Ä—Ñ)

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- [Python](https://www.python.org/)
- [Docker](https://www.docker.com/)
- [Pipenv](https://github.com/pypa/pipenv)
- [Redis](https://redis.io/)
- [aiogram](https://github.com/aiogram/aiogram)
- [pydantic](https://github.com/pydantic/pydantic)

## –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- Redis 7.0+
- Telegram bot token –æ—Ç [@BotFather](https://t.me/BotFather)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/005-bot/tg-bot.git
cd tg-bot
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pipenv install
```

3. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞:
```bash
cp .env.example .env
```

4. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env`:
```env
TELEGRAM__TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è              | –û–ø–∏—Å–∞–Ω–∏–µ                              | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é             |
| ----------------------- | ------------------------------------- | ------------------------ |
| `REDIS__URL`            | URL Redis —Å–µ—Ä–≤–µ—Ä–∞                     | `redis://localhost:6379` |
| `REDIS__PREFIX`         | –ü—Ä–µ—Ñ–∏–∫—Å –∫–ª—é—á–µ–π Redis                  | `bot-005`                |
| `TELEGRAM__TOKEN`       | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)     |                          |
| `HTTP__HOST`            | –•–æ—Å—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è webhook —Ä–µ–∂–∏–º–∞) | `0.0.0.0`                |
| `HTTP__PORT`            | –ü–æ—Ä—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è webhook —Ä–µ–∂–∏–º–∞) | `8000`                   |
| `HTTP__WEBHOOK_PATH`    | –ü—É—Ç—å –¥–ª—è webhook                      |                          |
| `TELEGRAM__WEBHOOK_URL` | –ü–æ–ª–Ω—ã–π URL –¥–ª—è webhook                |                          |
| `ADMIN__TELEGRAM_ID`    | ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π     |                          |

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫

```bash
pipenv run python -m app
```

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è üîî
- `/stop` - –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π üîï
- `/filter` - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ —É–ª–∏—Ü–µ üèòÔ∏è
- `/feedback` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ üí¨
- `/help` - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É ‚ùì

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`
2. –ë–æ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç –µ–≥–æ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
3. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏:
   - –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ë–æ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å emoji –ø–æ —Ç–∏–ø—É —Ä–µ—Å—É—Ä—Å–∞:
     - ‚ö°Ô∏è –≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ
     - üî• –ì–∞–∑
     - üíß –•–æ–ª–æ–¥–Ω–∞—è –≤–æ–¥–∞
     - üå°Ô∏è –ì–æ—Ä—è—á–∞—è –≤–æ–¥–∞
   - –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph LR
A[Redis Queue] --> B[Bot Listener]
B --> C{Filter by street?}
C -->|Yes| D[Format notification]
C -->|No| D
D --> E[Send to Telegram]
```

–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- `app/services/listener.py` - –°–ª—É—à–∞—Ç–µ–ª—å –æ—á–µ—Ä–µ–¥–∏ Redis
- `app/services/storage.py` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –≤ Redis
- `app/handlers/` - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ Telegram
- `app/config/config.py` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞

- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ —Ä–∞–π–æ–Ω–∞–º
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## –õ–∏—Ü–µ–Ω–∑–∏—è

–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π Apache 2.0. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ —Ñ–∞–π–ª–µ [LICENSE](LICENSE).
